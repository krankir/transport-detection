# transport-detection
## Описание
Платформа видеоаналитики – no-code платформа-конструктор, позволяющая собирать сценарии видеоаналитики с использованием технологий искусственного интеллекта и компьютерного зрения без написания кода.

### Технологии
- Python
- Postgresql
- FastAPI
- Selery
- RabbitMQ
- Docker

### Шаблон наполнения .env файла

```
- название базы для инициализации
```
POSTGRES_DB=postgres
```
- показ sql запросов в консоли
```
DB_ECHO=False
```
- имя базы данных
```
DB_NAME=postgres
```
- пользователь базы данных
```
POSTGRES_USER=postgres
```
- пароль пользователя базы данных
```
POSTGRES_PASSWORD=postgres
```
- название контейнера
```
DB_HOST=db
```
- порт для работы с базой данных
```
DB_PORT=5432
```
- Перейдите в диеректорию с файлом docker-compose
```
docker-compose up -d --build
```
- Добавить тестовые данные в базу данных
```
table pipelines

| name                | description           |
|---------------------|-----------------------|
| детекция автомобиля | обработка изображения |

table steps

| name                                   | queue_name       |
|----------------------------------------|------------------|
| обработка изображения                  | preprocessing    |
| прогон через модель машинного обучения | machine_learning |
| сохранение информации в БД             | save_in_database |


table pipeline_step_association

| pipeline_id | step_id |
|-------------|---------|
| 1           | 1       |
| 1           | 2       |
| 1           | 3       |

- Перейдите в директорию services/trainingservice и запустить скрипт
```
python3 main.py
```
- Перейдите в директорию services/dataservice и запустить скрипт
```
python3 main.py
```
- Перейти [docs](http://127.0.0.1:8000/docs) и можно начинать обработку изображения.

# Реализованный REST API сервис:

Сервис принимает на вход изображения и прогоняет их по различным пайплайнам обработки изображений.
 
Реализован пайплайн детекции автомобиля. Пайплайн состоит из следующих шагов:

- Обработка изображения
- Прогон обработанного изображения через модель машинного обучения
- Сохранение в БД информации, задетектирован ли на изображении автомобиль, а также координаты бокса автомобиля, если он задетектирован


### Пояснения:
Указывая в базе шаги при формировании пайплайна, тем самым формируем маршрут из сервисов.У каждого шага есть название очереди rabbit по которой собираются маршрут. Это позволяет сервису горизонтально масштабироваться, путем поднимания новых инстансов сервиса и увеличивая количества одновременно обрабатываемых сообщений для очереди, путем изменения параметра prefetch count для очереди.
### Автор
Анатолий Редько

### License
MIT